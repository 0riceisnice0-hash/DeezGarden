---
import { siteConfig } from '../config';

const baseUrl = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;

const withBase = (path: string) => `${baseUrl}${path.replace(/^\//, '')}`;

const stripBase = (pathname: string) => {
  if (pathname.startsWith(baseUrl)) {
    const stripped = pathname.slice(baseUrl.length - 1);
    return stripped.length ? stripped : '/';
  }
  return pathname;
};

const currentPath = stripBase(Astro.url.pathname);
---

<header class="sticky top-0 z-50 bg-white shadow-md">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between py-3 md:py-4">
      <!-- Logo -->
      <a href={withBase('/')} class="flex items-center">
        <img 
          src={withBase('/assets/images/logo-main.png')}
          alt="Dee'z Gardens" 
          class="h-8 md:h-10"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
        />
        <span class="hidden text-xl md:text-2xl font-bold text-deep-green tracking-tight logo-fallback">{siteConfig.name}</span>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-6">
        <a href={withBase('/')} class={`hover:text-fresh-green transition ${currentPath === '/' ? 'text-fresh-green font-semibold' : ''}`}>Home</a>
        <a href={withBase('/services/')} class={`hover:text-fresh-green transition ${currentPath.includes('/services') ? 'text-fresh-green font-semibold' : ''}`}>Services</a>
        <a href={withBase('/areas/')} class={`hover:text-fresh-green transition ${currentPath.includes('/areas') ? 'text-fresh-green font-semibold' : ''}`}>Areas</a>
        <a href={withBase('/reviews/')} class={`hover:text-fresh-green transition ${currentPath.includes('/reviews') ? 'text-fresh-green font-semibold' : ''}`}>Reviews</a>
        <a href={withBase('/gallery/')} class={`hover:text-fresh-green transition ${currentPath.includes('/gallery') ? 'text-fresh-green font-semibold' : ''}`}>Gallery</a>
        <a href={withBase('/contact/')} class={`hover:text-fresh-green transition ${currentPath.includes('/contact') ? 'text-fresh-green font-semibold' : ''}`}>Contact</a>
        <a href={`tel:${siteConfig.phone}`} class="bg-fresh-green text-white px-6 py-2 rounded-lg hover:bg-deep-green transition font-semibold">
          Call Now
        </a>
      </div>
      
      <!-- Mobile: Call Button + Hamburger -->
      <div class="flex items-center gap-3 md:hidden">
        <a href={`tel:${siteConfig.phone}`} class="bg-fresh-green text-white px-3 py-2 rounded-lg hover:bg-deep-green transition font-semibold text-sm">
          Call
        </a>
        <button 
          id="mobile-menu-button" 
          type="button"
          class="p-2 rounded-lg hover:bg-gray-100 transition focus:outline-none focus:ring-2 focus:ring-fresh-green"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <!-- Hamburger Icon -->
          <svg id="hamburger-icon" class="w-6 h-6 text-deep-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <!-- Close Icon (hidden by default) -->
          <svg id="close-icon" class="w-6 h-6 text-deep-green hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </nav>
  </div>
  
  <!-- Mobile Menu (hidden by default) -->
  <div id="mobile-menu" class="md:hidden bg-white border-t border-gray-100 mobile-menu-hidden">
    <div class="container mx-auto px-4 py-4">
      <div class="flex flex-col space-y-1">
        <a href={withBase('/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath === '/' ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Home</a>
        <a href={withBase('/services/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath.includes('/services') ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Services</a>
        <a href={withBase('/areas/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath.includes('/areas') ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Areas</a>
        <a href={withBase('/reviews/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath.includes('/reviews') ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Reviews</a>
        <a href={withBase('/gallery/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath.includes('/gallery') ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Gallery</a>
        <a href={withBase('/contact/')} class={`py-3 px-4 rounded-lg hover:bg-gray-50 hover:text-fresh-green transition text-lg ${currentPath.includes('/contact') ? 'text-fresh-green font-semibold bg-green-50' : ''}`}>Contact</a>
        <div class="pt-2 mt-2 mb-2 border-t border-gray-100">
          <a 
            href={`tel:${siteConfig.phone}`} 
            class="flex items-center justify-center py-3 px-4 bg-fresh-green text-white rounded-lg font-semibold text-lg hover:bg-deep-green transition"
          >
            ðŸ“ž Call {siteConfig.phoneFormatted}
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  /* Mobile menu animation */
  #mobile-menu {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.3s ease-out, opacity 0.25s ease-out;
  }
  
  #mobile-menu.mobile-menu-visible {
    max-height: 500px;
    opacity: 1;
    transition: max-height 0.35s ease-in, opacity 0.25s ease-in;
  }
  
  #mobile-menu.mobile-menu-hidden {
    max-height: 0;
    opacity: 0;
  }
  
  /* Hamburger icon animation */
  #hamburger-icon,
  #close-icon {
    transition: transform 0.2s ease, opacity 0.2s ease;
  }
  
  #hamburger-icon.icon-hidden {
    transform: rotate(90deg);
    opacity: 0;
  }
  
  #close-icon.icon-hidden {
    transform: rotate(-90deg);
    opacity: 0;
  }
</style>

<script>
  // Mobile menu toggle functionality with animation
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');

  if (menuButton && mobileMenu && hamburgerIcon && closeIcon) {
    // Initialize close icon as hidden
    closeIcon.classList.add('icon-hidden', 'hidden');
    
    menuButton.addEventListener('click', () => {
      const isHidden = mobileMenu.classList.contains('mobile-menu-hidden');
      
      if (isHidden) {
        // Open menu with animation
        mobileMenu.classList.remove('mobile-menu-hidden');
        mobileMenu.classList.add('mobile-menu-visible');
        hamburgerIcon.classList.add('icon-hidden');
        setTimeout(() => hamburgerIcon.classList.add('hidden'), 200);
        closeIcon.classList.remove('hidden');
        setTimeout(() => closeIcon.classList.remove('icon-hidden'), 10);
        menuButton.setAttribute('aria-expanded', 'true');
        menuButton.setAttribute('aria-label', 'Close menu');
      } else {
        // Close menu with animation
        mobileMenu.classList.remove('mobile-menu-visible');
        mobileMenu.classList.add('mobile-menu-hidden');
        closeIcon.classList.add('icon-hidden');
        setTimeout(() => closeIcon.classList.add('hidden'), 200);
        hamburgerIcon.classList.remove('hidden');
        setTimeout(() => hamburgerIcon.classList.remove('icon-hidden'), 10);
        menuButton.setAttribute('aria-expanded', 'false');
        menuButton.setAttribute('aria-label', 'Open menu');
      }
    });

    // Close menu when clicking on a link
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('mobile-menu-visible');
        mobileMenu.classList.add('mobile-menu-hidden');
        closeIcon.classList.add('icon-hidden');
        setTimeout(() => closeIcon.classList.add('hidden'), 200);
        hamburgerIcon.classList.remove('hidden');
        setTimeout(() => hamburgerIcon.classList.remove('icon-hidden'), 10);
        menuButton.setAttribute('aria-expanded', 'false');
        menuButton.setAttribute('aria-label', 'Open menu');
      });
    });

    // Close menu when clicking outside
    document.addEventListener('click', (event) => {
      const target = event.target;
      if (target instanceof Node && !menuButton.contains(target) && !mobileMenu.contains(target)) {
        if (mobileMenu.classList.contains('mobile-menu-visible')) {
          mobileMenu.classList.remove('mobile-menu-visible');
          mobileMenu.classList.add('mobile-menu-hidden');
          closeIcon.classList.add('icon-hidden');
          setTimeout(() => closeIcon.classList.add('hidden'), 200);
          hamburgerIcon.classList.remove('hidden');
          setTimeout(() => hamburgerIcon.classList.remove('icon-hidden'), 10);
          menuButton.setAttribute('aria-expanded', 'false');
          menuButton.setAttribute('aria-label', 'Open menu');
        }
      }
    });
  }
</script>
