---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import CallToAction from '../../components/CallToAction.astro';
import { siteConfig } from '../../config';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout 
  title={post.data.title}
  description={post.data.description}
>
  <Header slot="header" />
  
  <article class="py-16">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <!-- Breadcrumb -->
        <nav class="mb-8 text-sm">
          <a href="/DeezGarden/" class="text-fresh-green hover:text-deep-green">Home</a>
          <span class="mx-2">/</span>
          <a href="/DeezGarden/blog/" class="text-fresh-green hover:text-deep-green">Blog</a>
          <span class="mx-2">/</span>
          <span class="text-gray-600">{post.data.title}</span>
        </nav>
        
        <!-- Article Header -->
        <header class="mb-8">
          <div class="flex flex-wrap items-center gap-4 mb-4 text-sm text-gray-600">
            <time datetime={post.data.pubDate.toISOString()}>
              {post.data.pubDate.toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
              })}
            </time>
            <span>•</span>
            <span class="capitalize">{post.data.category}</span>
            <span>•</span>
            <span>{post.data.author}</span>
          </div>
          
          <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
          <p class="text-xl text-gray-700">{post.data.description}</p>
          
          {post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-6">
              {post.data.tags.map(tag => (
                <span class="bg-light-green/20 text-deep-green px-3 py-1 rounded-full text-sm font-medium">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </header>
        
        <!-- Article Content -->
        <div class="prose prose-lg max-w-none
          prose-headings:text-deep-green
          prose-a:text-fresh-green hover:prose-a:text-deep-green
          prose-strong:text-deep-green
          prose-ul:list-disc
          prose-ol:list-decimal
        ">
          <Content />
        </div>
        
        <!-- Author Bio -->
        <div class="mt-12 p-6 bg-bg-light rounded-lg">
          <h3 class="text-xl font-bold mb-2">About {post.data.author}</h3>
          <p class="text-gray-700">
            {siteConfig.name} provides professional garden maintenance and clearance services throughout Northampton and Northamptonshire. With years of experience and a commitment to quality, we're your local choice for all garden and clearance needs.
          </p>
          <a 
            href="/DeezGarden/contact/"
            class="inline-block mt-4 text-fresh-green font-semibold hover:text-deep-green"
          >
            Contact Us →
          </a>
        </div>
      </div>
    </div>
  </article>
  
  <CallToAction />
  
  <Footer slot="footer" />
</BaseLayout>

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "datePublished": post.data.pubDate.toISOString(),
  "author": {
    "@type": "Organization",
    "name": siteConfig.name
  },
  "publisher": {
    "@type": "Organization",
    "name": siteConfig.name
  },
  "keywords": post.data.tags.join(', ')
})} />

<style>
  /* Prose styling for better readability */
  .prose {
    color: var(--color-text);
  }
  
  .prose h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  .prose h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }
  
  .prose p {
    margin-bottom: 1rem;
  }
  
  .prose ul, .prose ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  
  .prose li {
    margin-bottom: 0.5rem;
  }
</style>
